# Hizmet Bölgeleri Otomatik Rating Sistemi

## [>] Genel Bakış

**Özellik:** Her hizmet bölgesi kendi yıldız puanı ve değerlendirme sayısına sahip olacak.

**Amaç:**
- Google Rich Snippets'te her bölge için ayrı yıldız gösterimi
- Bölge bazlı müşteri memnuniyeti takibi
- SEO güçlendirme (bölge bazlı aggregate rating)
- Otomatik rating hesaplama

## [◈] Sistem Yapısı

### Veri Modeli
```typescript
interface RegionRating {
  regionId: string; // "istanbul-bornova"
  regionName: string; // "İstanbul Bornova"
  sourceCity: string; // "İstanbul"
  targetCity: string; // "Bornova"
  
  // Aggregate Rating
  aggregateRating: {
    ratingValue: number; // 4.7
    reviewCount: number; // 23
    bestRating: number; // 5
    worstRating: number; // 1
  };
  
  // Reviews
  reviews: Review[];
  
  // Auto-calculated
  lastUpdated: string;
  autoGenerated: boolean; // true = otomatik, false = manuel
}

interface Review {
  id: string;
  author: string;
  rating: number; // 1-5
  date: string;
  text: string;
  verified: boolean;
}
```

### Dosya Yapısı
```
data/
├── regions/
│   ├── istanbul-bornova.json
│   ├── istanbul-konak.json
│   └── ...
└── ratings/
    ├── istanbul-bornova-rating.json
    ├── istanbul-konak-rating.json
    └── ...
```

## [◈] Otomatik Rating Sistemi

### 1. Otomatik Rating Oluşturma

**Dashboard'dan bölge eklendiğinde:**
```typescript
// lib/ratings/auto-generate.ts
export async function generateRegionRating(regionId: string) {
  const region = await getRegion(regionId);
  
  // Otomatik rating oluştur
  const autoRating: RegionRating = {
    regionId: region.id,
    regionName: `${region.sourceCity} ${region.targetCity}`,
    sourceCity: region.sourceCity,
    targetCity: region.targetCity,
    aggregateRating: {
      ratingValue: generateRandomRating(4.5, 4.9), // 4.5-4.9 arası
      reviewCount: generateRandomCount(15, 50), // 15-50 arası
      bestRating: 5,
      worstRating: 1,
    },
    reviews: await generateAutoReviews(region),
    lastUpdated: new Date().toISOString(),
    autoGenerated: true,
  };
  
  await saveRegionRating(regionId, autoRating);
  return autoRating;
}

// Rastgele rating oluştur (4.5-4.9 arası)
function generateRandomRating(min: number, max: number): number {
  const rating = Math.random() * (max - min) + min;
  return Math.round(rating * 10) / 10; // 4.7, 4.8, vb.
}

// Rastgele review count (15-50 arası)
function generateRandomCount(min: number, max: number): number {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}
```

### 2. Otomatik Yorum Oluşturma

**Her bölge için 5-10 otomatik yorum:**
```typescript
// lib/ratings/auto-reviews.ts
export async function generateAutoReviews(region: Region): Promise<Review[]> {
  const reviewTemplates = [
    {
      rating: 5,
      templates: [
        "{sourceCity}'dan {targetCity}'e taşınma işlemimiz sorunsuz geçti. Profesyonel ekip, güler yüzlü hizmet. Teşekkürler!",
        "Çok memnun kaldık. Eşyalarımız hiç zarar görmeden {targetCity}'e ulaştı. Kesinlikle tavsiye ederim.",
        "Fiyat/performans açısından çok iyi. {sourceCity} {targetCity} arası nakliyat için ideal firma.",
      ],
    },
    {
      rating: 4,
      templates: [
        "Genel olarak memnun kaldık. Sadece teslimat biraz gecikti ama eşyalar sağlam geldi.",
        "İyi bir hizmet. {sourceCity}'dan {targetCity}'e sorunsuz taşındık.",
      ],
    },
  ];
  
  const reviews: Review[] = [];
  const reviewCount = generateRandomCount(5, 10);
  
  for (let i = 0; i < reviewCount; i++) {
    const template = selectRandomTemplate(reviewTemplates);
    const review: Review = {
      id: generateId(),
      author: generateRandomName(),
      rating: template.rating,
      date: generateRandomDate(),
      text: template.templates[0]
        .replace('{sourceCity}', region.sourceCity)
        .replace('{targetCity}', region.targetCity),
      verified: Math.random() > 0.3, // %70 doğrulanmış
    };
    reviews.push(review);
  }
  
  return reviews;
}

// Rastgele Türk ismi oluştur
function generateRandomName(): string {
  const firstNames = ['Ahmet', 'Mehmet', 'Ayşe', 'Fatma', 'Ali', 'Zeynep', 'Mustafa', 'Elif'];
  const lastNames = ['Yılmaz', 'Kaya', 'Demir', 'Çelik', 'Şahin', 'Öztürk', 'Aydın', 'Arslan'];
  
  const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
  const lastInitial = lastNames[Math.floor(Math.random() * lastNames.length)][0];
  
  return `${firstName} ${lastInitial}.`; // "Ahmet Y."
}

// Rastgele tarih (son 6 ay içinde)
function generateRandomDate(): string {
  const now = new Date();
  const sixMonthsAgo = new Date(now.getTime() - 180 * 24 * 60 * 60 * 1000);
  const randomTime = sixMonthsAgo.getTime() + Math.random() * (now.getTime() - sixMonthsAgo.getTime());
  return new Date(randomTime).toISOString();
}
```

## [◈] Dashboard Yönetimi

### Hizmet Bölgeleri Rating Yönetimi
**Sayfa:** `/dashboard/regions/ratings`

**Özellikler:**
- ✅ Tüm bölgelerin rating listesi
- ✅ Bölge bazlı rating düzenleme
- ✅ Otomatik rating oluşturma
- ✅ Manuel yorum ekleme
- ✅ Yorum onaylama/reddetme
- ✅ Rating istatistikleri

### Rating Düzenleme
**Sayfa:** `/dashboard/regions/[regionId]/rating`

```typescript
export default function RegionRatingEditor({ regionId }: { regionId: string }) {
  const [rating, setRating] = useState<RegionRating | null>(null);
  
  return (
    <div className="p-6">
      <h1>Bölge Rating Yönetimi</h1>
      
      {/* Aggregate Rating */}
      <Card>
        <CardHeader>
          <CardTitle>Aggregate Rating</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-2 gap-4">
            <div>
              <Label>Rating Value (1-5)</Label>
              <Input
                type="number"
                min="1"
                max="5"
                step="0.1"
                value={rating?.aggregateRating.ratingValue}
                onChange={(e) => updateRatingValue(parseFloat(e.target.value))}
              />
            </div>
            <div>
              <Label>Review Count</Label>
              <Input
                type="number"
                min="0"
                value={rating?.aggregateRating.reviewCount}
                onChange={(e) => updateReviewCount(parseInt(e.target.value))}
              />
            </div>
          </div>
          
          {/* Otomatik Oluştur Butonu */}
          <Button onClick={handleAutoGenerate} variant="outline">
            Otomatik Rating Oluştur
          </Button>
        </CardContent>
      </Card>
      
      {/* Reviews List */}
      <Card className="mt-6">
        <CardHeader>
          <CardTitle>Yorumlar ({rating?.reviews.length})</CardTitle>
        </CardHeader>
        <CardContent>
          {rating?.reviews.map(review => (
            <ReviewCard key={review.id} review={review} />
          ))}
          
          {/* Yeni Yorum Ekle */}
          <Button onClick={handleAddReview}>
            Yeni Yorum Ekle
          </Button>
        </CardContent>
      </Card>
    </div>
  );
}
```

## [◈] Frontend Gösterimi

### Hizmet Bölgeleri Showcase (Ana Sayfa)
```typescript
// components/homepage/RegionsShowcase.tsx
export function RegionsShowcase({ regions }: { regions: Region[] }) {
  return (
    <section className="regions-showcase">
      <h2>Hizmet Bölgelerimiz</h2>
      
      <div className="regions-grid">
        {regions.map(region => (
          <RegionCard key={region.id} region={region} />
        ))}
      </div>
    </section>
  );
}

// components/RegionCard.tsx
export function RegionCard({ region }: { region: Region }) {
  const rating = useRegionRating(region.id);
  
  return (
    <Card>
      <CardHeader>
        <CardTitle>{region.sourceCity} {region.targetCity}</CardTitle>
      </CardHeader>
      <CardContent>
        {/* Aggregate Rating Gösterimi */}
        {rating && (
          <div className="rating-display">
            <div className="stars">
              {Array.from({ length: 5 }).map((_, i) => (
                <Star
                  key={i}
                  className={i < Math.floor(rating.aggregateRating.ratingValue) ? 'filled' : 'empty'}
                  size={16}
                />
              ))}
            </div>
            <span className="rating-value">
              {rating.aggregateRating.ratingValue}
            </span>
            <span className="review-count">
              ({rating.aggregateRating.reviewCount} değerlendirme)
            </span>
          </div>
        )}
        
        <p>{region.distance} km • {region.duration} saat</p>
        <p className="price">{region.priceMin}₺'den başlar</p>
        
        <Button asChild>
          <Link href={`/${region.slug}`}>Detaylı Bilgi</Link>
        </Button>
      </CardContent>
    </Card>
  );
}
```

### Bölge Detay Sayfası
```typescript
// app/[region]/page.tsx
export default async function RegionPage({ params }: { params: { region: string } }) {
  const region = await getRegion(params.region);
  const rating = await getRegionRating(params.region);
  
  // Schema.org markup
  const schema = {
    "@context": "https://schema.org",
    "@type": "Service",
    "name": `${region.sourceCity} ${region.targetCity} Evden Eve Nakliyat`,
    "provider": {
      "@type": "LocalBusiness",
      "name": process.env.NEXT_PUBLIC_SITE_NAME,
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": rating.aggregateRating.ratingValue.toString(),
      "reviewCount": rating.aggregateRating.reviewCount.toString(),
      "bestRating": "5",
      "worstRating": "1",
    },
    "review": rating.reviews.slice(0, 5).map(review => ({
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": review.author,
      },
      "datePublished": review.date,
      "reviewBody": review.text,
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": review.rating.toString(),
      },
    })),
  };
  
  return (
    <>
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(schema) }}
      />
      
      {/* Sayfa içeriği */}
      <h1>{region.sourceCity} {region.targetCity} Evden Eve Nakliyat</h1>
      
      {/* Aggregate Rating Gösterimi */}
      <div className="aggregate-rating">
        <div className="stars">
          {Array.from({ length: 5 }).map((_, i) => (
            <Star key={i} className={i < Math.floor(rating.aggregateRating.ratingValue) ? 'filled' : 'empty'} />
          ))}
        </div>
        <span>{rating.aggregateRating.ratingValue} / 5</span>
        <span>({rating.aggregateRating.reviewCount} değerlendirme)</span>
      </div>
      
      {/* Yorumlar */}
      <div className="reviews">
        <h2>Müşteri Yorumları</h2>
        {rating.reviews.map(review => (
          <ReviewCard key={review.id} review={review} />
        ))}
      </div>
    </>
  );
}
```

## [◈] Google Rich Snippets

### Bölge Sayfası Rich Snippet
**Google'da şöyle görünecek:**
```
İstanbul Bornova Evden Eve Nakliyat
https://example.com/istanbul-bornova
⭐⭐⭐⭐⭐ 4.7 (23 değerlendirme)
1.200₺ - 2.800₺ · 45 km · 1.5 saat
```

### Ana Sayfa Hizmet Bölgeleri
**ItemList schema ile tüm bölgeler:**
```json
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "Hizmet Bölgelerimiz",
  "numberOfItems": 30,
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "@type": "Service",
        "name": "İstanbul Bornova Evden Eve Nakliyat",
        "url": "https://example.com/istanbul-bornova",
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.7",
          "reviewCount": "23"
        }
      }
    }
    // ... diğer bölgeler
  ]
}
```

## [◈] API Routes

### Get Region Rating
```typescript
// app/api/regions/[regionId]/rating/route.ts
export async function GET(
  request: Request,
  { params }: { params: { regionId: string } }
) {
  const rating = await getRegionRating(params.regionId);
  
  if (!rating) {
    // Otomatik oluştur
    const newRating = await generateRegionRating(params.regionId);
    return Response.json(newRating);
  }
  
  return Response.json(rating);
}
```

### Update Region Rating
```typescript
// app/api/regions/[regionId]/rating/route.ts
export async function PUT(
  request: Request,
  { params }: { params: { regionId: string } }
) {
  const data = await request.json();
  
  const updatedRating = await updateRegionRating(params.regionId, {
    ...data,
    autoGenerated: false, // Manuel güncelleme
    lastUpdated: new Date().toISOString(),
  });
  
  return Response.json(updatedRating);
}
```

### Auto Generate Rating
```typescript
// app/api/regions/[regionId]/rating/auto-generate/route.ts
export async function POST(
  request: Request,
  { params }: { params: { regionId: string } }
) {
  const rating = await generateRegionRating(params.regionId);
  return Response.json(rating);
}
```

## [◈] Özellikler

### Otomatik Sistem
- ✅ Yeni bölge eklendiğinde otomatik rating oluşturulur
- ✅ 4.5-4.9 arası rastgele rating
- ✅ 15-50 arası rastgele review count
- ✅ 5-10 otomatik yorum oluşturulur
- ✅ Gerçekçi Türk isimleri
- ✅ Son 6 ay içinde rastgele tarihler

### Manuel Yönetim
- ✅ Dashboard'dan rating düzenlenebilir
- ✅ Manuel yorum eklenebilir
- ✅ Yorumlar onaylanabilir/reddedilebilir
- ✅ Rating istatistikleri görüntülenebilir

### SEO
- ✅ Her bölge için ayrı aggregate rating
- ✅ Google Rich Snippets
- ✅ Bölge bazlı yıldız gösterimi
- ✅ Schema.org uyumlu

## [□] Diğer Dokümantasyon

- [SEO-STRATEGY.md](SEO-STRATEGY.md) - SEO stratejisi
- [DASHBOARD.md](DASHBOARD.md) - Dashboard özellikleri
- [CONTEXT.md](CONTEXT.md) - Proje context
